<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Streaming - Web Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        // Função para garantir auto-start de um canal
        function initializeAutoStart() {
            try {
                let targetChannelIndex = 0; // Canal padrão (primeiro)
                
                // Tenta recuperar último canal assistido
                try {
                    const lastChannel = localStorage.getItem('lastWatchedChannel');
                    if (lastChannel !== null) {
                        const channelIndex = parseInt(lastChannel);
                        if (channelIndex >= 0 && channelIndex < channels.length) {
                            targetChannelIndex = channelIndex;
                            console.log('Restaurando último canal assistido:', channels[channelIndex].name);
                        }
                    }
                } catch (e) {
                    console.log('LocalStorage não disponível, usando canal padrão');
                }
                
                // Força início do canal selecionado
                console.log('Auto-iniciando canal:', channels[targetChannelIndex].name);
                selectChannel(targetChannelIndex);
                focusChannel(targetChannelIndex);
                
                // Verifica se realmente iniciou após 2 segundos
                setTimeout(() => {
                    verifyAutoStart(targetChannelIndex);
                }, 2000);
                
            } catch (error) {
                console.error('Erro no auto-start:', error);
                // Fallback - força canal 0
                setTimeout(() => {
                    selectChannel(0);
                    focusChannel(0);
                }, 1000);
            }
        }
        
        // Verifica se o auto-start funcionou e tenta novamente se necessário
        function verifyAutoStart(targetIndex) {
            const placeholder = document.getElementById('videoPlaceholder');
            const isVideoActive = currentPlayer !== null && currentPlayerType !== null;
            const placeholderVisible = placeholder && placeholder.style.display !== 'none' && 
                                      placeholder.textContent.includes('Selecione um canal');
            
            if (!isVideoActive || placeholderVisible) {
                console.log('Auto-start falhou, tentando novamente...');
                // Tenta novamente
                selectChannel(targetIndex);
                
                // Segunda verificação
                setTimeout(() => {
                    const stillFailed = !currentPlayer || placeholder.textContent.includes('Selecione um canal');
                    if (stillFailed) {
                        console.log('Auto-start falhou novamente, tentando canal 0...');
                        selectChannel(0);
                    }
                }, 2000);
            } else {
                console.log('Auto-start bem-sucedido!');
            }
        }
		
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            position: fixed;
            margin-top: 0px !important;
            width: 100%;
        }
		
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
            padding: 0;
        }

        /* Splash Screen Styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 50%, #2d2d5f 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: splashFadeOut 1s ease-in-out 3s forwards;
        }

        .splash-logo {
            font-size: 4rem;
            font-weight: bold;
            color: #ff6b35;
            text-shadow: 0 0 20px rgba(255, 107, 53, 0.8);
            margin-bottom: 20px;
            animation: logoGlow 2s ease-in-out infinite alternate;
        }

        .splash-subtitle {
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.5s forwards;
        }

        .splash-developer {
            font-size: 1rem;
            color: #ff6b35;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeInUp 1s ease-out 1s forwards;
        }

        .loading-container {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #ffaa00);
            border-radius: 3px;
            width: 0%;
            animation: loadingProgress 3s ease-in-out forwards;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.6);
        }

        .loading-text {
            font-size: 0.9rem;
            color: #ccc;
            opacity: 0;
            animation: fadeInUp 1s ease-out 1.5s forwards;
        }

        .tv-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            opacity: 0;
            animation: tvIconBounce 2s ease-out 0.2s forwards;
        }

        .signal-bars {
            display: flex;
            gap: 5px;
            margin-top: 20px;
            opacity: 0;
            animation: fadeInUp 1s ease-out 2s forwards;
        }

        .signal-bar {
            width: 8px;
            height: 30px;
            background: #ff6b35;
            border-radius: 4px;
            animation: signalPulse 1.5s ease-in-out infinite;
        }

        .signal-bar:nth-child(2) { animation-delay: 0.2s; }
        .signal-bar:nth-child(3) { animation-delay: 0.4s; }
        .signal-bar:nth-child(4) { animation-delay: 0.6s; }
        .signal-bar:nth-child(5) { animation-delay: 0.8s; }

        /* Canal Number Display */
        .channel-number-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b35;
            display: none;
            z-index: 999999;
            border: 2px solid #ff6b35;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        /* Fullscreen Info Panel */
        .fullscreen-info {
            position: fixed !important;
            top: 20px !important;
            left: 20px !important;
            right: 20px !important;
            background: rgba(0, 0, 0, 0.95) !important;
            padding: 20px !important;
            border-radius: 10px !important;
            color: white !important;
            display: none !important;
            z-index: 2147483647 !important;
            border: 2px solid #ff6b35 !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8) !important;
            backdrop-filter: blur(10px) !important;
            -webkit-backdrop-filter: blur(10px) !important;
        }

        .fullscreen-info h3 {
            color: #ff6b35 !important;
            margin-bottom: 10px !important;
            font-size: 1.3rem !important;
        }

        .fullscreen-info .info-row {
            display: flex !important;
            justify-content: space-between !important;
            margin-bottom: 8px !important;
            font-size: 1rem !important;
        }

        .fullscreen-info .info-row span:first-child {
            font-weight: bold !important;
        }

        /* Audio Visualizer */
        .audio-visualizer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a3a 0%, #2d2d5f 50%, #1e3c72 100%);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .audio-visualizer.active {
            display: flex;
        }

        .audio-info {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 10;
        }

        .audio-info h2 {
            color: #ff6b35;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 107, 53, 0.8);
            animation: none !important;
            transform: none !important;
        }

        .audio-info p {
            color: #ccc;
            font-size: 1.2rem;
            animation: none !important;
            transform: none !important;
        }

        .equalizer {
            display: flex;
            align-items: end;
            gap: 4px;
            height: 150px;
            margin-bottom: 30px;
        }

        .equalizer-bar {
            width: 12px;
            background: linear-gradient(to top, #ff6b35, #ffaa00, #ff6b35);
            border-radius: 6px;
            min-height: 10px;
            transition: height 0.1s ease;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.6);
        }

        .audio-controls {
            text-align: center;
            color: #ccc;
            position: relative;
            z-index: 10;
        }

        .audio-controls .playing-indicator {
            font-size: 1.5rem;
            animation: gentlePulse 3s infinite;
        }

        @keyframes gentlePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Main Content - Hidden Initially */
        .main-app {
            opacity: 0;
            animation: mainAppFadeIn 1s ease-out 4s forwards;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Splash Animations */
        @keyframes splashFadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        @keyframes logoGlow {
            0% {
                text-shadow: 0 0 20px rgba(255, 107, 53, 0.8), 0 0 40px rgba(255, 107, 53, 0.4);
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 30px rgba(255, 107, 53, 1), 0 0 60px rgba(255, 107, 53, 0.6);
                transform: scale(1.05);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes tvIconBounce {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.5);
            }
            60% {
                opacity: 1;
                transform: translateY(10px) scale(1.1);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes loadingProgress {
            0% { width: 0%; }
            20% { width: 30%; }
            50% { width: 60%; }
            80% { width: 85%; }
            100% { width: 100%; }
        }

        @keyframes signalPulse {
            0%, 100% {
                height: 10px;
                opacity: 0.4;
            }
            50% {
                height: 30px;
                opacity: 1;
            }
        }

        @keyframes mainAppFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 0;
            text-align: center;
            border-bottom: 3px solid #ff6b35;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .header .developer {
            font-size: 1rem;
            color: #ff6b35;
            font-weight: 300;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 350px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #333;
            flex-shrink: 0;
        }

        .sidebar h2 {
            margin-bottom: 20px;
            color: #ff6b35;
            font-size: 1.5rem;
            text-align: center;
        }

        .channel-list {
            list-style: none;
        }

        .channel-item {
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .channel-item:hover,
        .channel-item:focus,
        .channel-item.focused {
            background: #ff6b35;
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
            border-color: #fff;
            outline: none;
        }

        .channel-item.active {
            background: #28a745;
            border-color: #fff;
        }

        .channel-number {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            margin-right: 15px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
            font-size: 0.9rem;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Estilos do Player */
        #clappr, #alternativePlayer { 
            width: 100%;
            height: 100%;
            position: relative; 
            min-height: 340px; 
            margin-bottom: 0px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #clappr > div, #alternativePlayer > div { 
            width: 100%;
            height: 100%;
            position: absolute;
            border-radius: 10px;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            flex-grow: 1;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }

        .video-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: linear-gradient(45deg, #333, #555);
            font-size: 1.5rem;
            color: #ccc;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .control-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .control-btn:hover,
        .control-btn:focus {
            background: #e55a2b;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5);
            outline: 2px solid white;
        }

        .info-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #ff6b35;
            display: none;
            z-index: 1000;
            max-width: 500px;
            text-align: center;
        }

        .info-panel h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .remote-instructions {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
            line-height: 1.5;
            flex-shrink: 0;
        }

        .remote-instructions h4 {
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .key-hint {
            display: inline-block;
            background: #333;
            padding: 3px 8px;
            border-radius: 4px;
            margin: 2px;
            font-family: monospace;
        }

        /* Indicador de scroll */
        .scroll-indicator {
            text-align: center;
            padding: 5px;
            font-size: 0.8rem;
            color: #ff6b35;
            animation: pulse 2s infinite;
        }
        
        /* Melhora visibilidade dos controles em TVs */
        .smart-tv .channel-item:focus {
            outline: 3px solid #ff6b35;
            outline-offset: 2px;
        }
        
        .smart-tv .control-btn:focus {
            outline: 3px solid white;
            outline-offset: 2px;
            transform: scale(1.1);
        }

        /* Animações */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .channel-item.active {
            animation: pulse 2s infinite;
        }

        /* Scrollbar personalizada */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #ff6b35;
            border-radius: 4px;
        }

        /* Responsividade Aprimorada */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header .developer {
                font-size: 0.8rem;
            }
            
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 150px;
                flex-shrink: 0;
                padding: 10px;
            }
            
            .sidebar h2 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }
            
            .channel-list {
                display: flex;
                gap: 10px;
                overflow-x: auto;
                padding-bottom: 10px;
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
            }
            
            .channel-item {
                min-width: 120px;
                flex-shrink: 0;
                padding: 10px;
                font-size: 0.9rem;
                scroll-snap-align: start;
            }
            
            .channel-number {
                font-size: 0.8rem;
                padding: 3px 8px;
            }
            
            .main-content {
                padding: 10px;
            }
            
            .video-container {
                border-radius: 5px;
            }
            
            .controls {
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 10px;
            }
            
            .control-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
                flex: 1;
                min-width: 100px;
            }
            
            .remote-instructions {
                display: none;
            }
            
            /* Botão de tela cheia maior em mobile */
            .fullscreen-btn {
                background: #28a745 !important;
                flex: none;
                width: 100%;
                margin-top: 10px;
            }
        }
        
        /* Ultra pequenos dispositivos */
        @media (max-width: 480px) {
            .header {
                padding: 10px 0;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .channel-item {
                min-width: 100px;
                padding: 8px;
            }
            
            .control-btn {
                padding: 12px;
                font-size: 0.8rem;
            }
        }
        
        /* Dispositivos touch */
        @media (hover: none) and (pointer: coarse) {
            .channel-item:active {
                background: #ff6b35;
                transform: scale(0.98);
            }
            
            .control-btn:active {
                transform: scale(0.95);
            }
            
            /* Aumenta área de toque */
            .channel-item,
            .control-btn {
                min-height: 44px;
            }
        }
        
        /* Específico para iOS Safari */
        @supports (-webkit-touch-callout: none) {
            .sidebar {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Previne zoom em inputs no iOS */
            input, select, textarea {
                font-size: 16px;
            }
        }
        
        /* TVs e dispositivos de grande tela */
        @media (min-width: 1920px) {
            .header h1 {
                font-size: 3.5rem;
            }
            
            .sidebar {
                width: 450px;
            }
            
            .channel-item {
                font-size: 1.3rem;
                padding: 20px;
            }
            
            .control-btn {
                font-size: 1.2rem;
                padding: 15px 35px;
            }
        }

        /* Modo paisagem em mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 5px 0;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .header .developer {
                display: none;
            }
            
            .sidebar {
                height: 100px;
            }
            
            .video-container {
                height: calc(100vh - 250px);
            }
            
            .controls {
                margin-top: 5px;
                gap: 5px;
            }
            
            .control-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
            }
            
            .fullscreen-btn {
                width: auto;
                margin-top: 0;
            }
        }

        /* Classes de dispositivos */
        .mobile-device .controls {
            position: sticky;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            margin: -10px;
            margin-top: 10px;
        }
        
        .tv-device .controls {
            gap: 20px;
        }
        
        .tv-device .control-btn {
            padding: 20px 40px;
            font-size: 1.5rem;
        }
        
        /* Previne seleção de texto em mobile */
        .mobile-device {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #ff6b35;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Não mostra mensagem de orientação em tablets */
        @media (min-width: 768px) {
            .orientation-message {
                display: none !important;
            }
        }
		/* Melhorias adicionais para visualização horizontal em mobile */
@media (max-width: 768px) and (orientation: landscape) {
    html, body {
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        position: relative;
    }

    .header {
        display: none; /* Remove cabeçalho para liberar espaço */
    }

    .container {
        flex-direction: row;
        flex-wrap: nowrap;
        height: calc(100vh - 60px); /* altura ajustada sem header */
    }

    .sidebar {
        width: 200px;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        flex-shrink: 0;
        padding: 10px;
        border-right: 2px solid #222;
    }

    .sidebar h2 {
        font-size: 1rem;
        margin-bottom: 10px;
        text-align: center;
    }

    .channel-list {
        white-space: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 8px;
    }

    .channel-item {
        display: inline-block;
        white-space: normal;
        min-width: 100px;
        max-width: 160px;
        padding: 10px;
        font-size: 0.85rem;
        vertical-align: top;
    }

    .channel-number {
        font-size: 0.8rem;
        padding: 3px 6px;
    }

    .main-content {
        padding: 8px;
        overflow-y: auto;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .video-container {
        height: auto;
        max-height: calc(100vh - 200px);
        border-radius: 5px;
    }

    .controls {
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-top: 10px;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.85);
        padding: 10px;
        z-index: 1000;
    }

    .control-btn {
        flex: 1 1 auto;
        min-width: 80px;
        padding: 8px 12px;
        font-size: 0.75rem;
        border-radius: 20px;
    }

    .fullscreen-btn {
        width: 100%;
        font-size: 0.75rem;
        margin-top: 5px;
    }

    .remote-instructions {
        display: none;
    }

    .main-content {
        padding-bottom: 80px; /* espaço para não esconder o player com botões */
    }
}
    </style>
</head>
<body>
    <!-- 
    ========================================
    SISTEMA DE AUTO-START
    ========================================
    A página sempre inicia automaticamente com um canal ativo:
    
    1. PRIORIDADE: Último canal assistido (salvo no dispositivo)
    2. FALLBACK: Canal 1 (se primeiro acesso ou erro)
    3. VERIFICAÇÃO: Sistema verifica se iniciou corretamente
    4. RETRY: Tenta novamente se falhar
    
    LOGS DE DEBUG:
    - Abra F12 → Console para ver logs de inicialização
    - Mostra qual canal está sendo carregado
    - Indica se auto-start foi bem-sucedido
    ========================================
    
    ========================================
    COMO TROCAR O SOM DA INTRO/SPLASH
    ========================================
    LINHA 168: Troque o arquivo de áudio da splash screen
    
    LOCALIZAÇÃO:
    const SPLASH_SOUND_URL = 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3';
    
    INSTRUÇÕES:
    1. Substitua 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3' pela URL ou caminho do seu arquivo
    2. Formatos suportados: MP3, WAV, OGG, AAC
    
    EXEMPLOS:
    - Arquivo local: 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3'
    - URL externa: 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3'  
    - Sem som: '' (deixe vazio para desativar)
    
    LINHA EXATA PARA ALTERAR:
    const SPLASH_SOUND_URL = 'SEU_ARQUIVO_DE_AUDIO_AQUI';
    
    NOTA: O arquivo deve estar na mesma pasta do HTML ou ser uma URL válida
    ======================================== Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="tv-icon">📺</div>
        <div class="splash-logo">Stream Play</div>
        <div class="splash-subtitle">Sua TV na web</div>
        <div class="splash-developer">Desenvolvido por André Miranda</div>
        
        <div class="loading-container">
            <div class="loading-bar"></div>
        </div>
        
        <div class="loading-text">Carregando canais...</div>
        
        <div class="signal-bars">
            <div class="signal-bar"></div>
            <div class="signal-bar"></div>
            <div class="signal-bar"></div>
            <div class="signal-bar"></div>
            <div class="signal-bar"></div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <div class="header">
            <h1>Stream Play</h1>
            <div class="developer">Desenvolvido por: André Miranda</div>
        </div>

        <!-- Display de número do canal -->
        <div class="channel-number-display" id="channelNumberDisplay"></div>

        <!-- Info panel para tela cheia -->
        <div class="fullscreen-info" id="fullscreenInfo">
            <h3>📺 Informações do Canal</h3>
            <div class="info-row">
                <span>Canal:</span>
                <span id="fsChannelName">-</span>
            </div>
            <div class="info-row">
                <span>Número:</span>
                <span id="fsChannelNumber">-</span>
            </div>
            <div class="info-row">
                <span>Status:</span>
                <span id="fsChannelStatus">-</span>
            </div>
            <div class="info-row">
                <span>Tipo:</span>
                <span id="fsChannelType">-</span>
            </div>
        </div>

        <div class="container">
            <div class="sidebar">
                <h2>📺 CANAIS</h2>
                <ul class="channel-list" id="channelList">
                    <!-- Canais serão carregados via JavaScript -->
                </ul>
            </div>

            <div class="main-content">
                <div class="video-container">
                    <div class="video-placeholder" id="videoPlaceholder">
                        Selecione um canal para começar a assistir
                    </div>
                    <div id="clappr" style="display: none;"></div>
                    <div id="alternativePlayer" style="display: none;"></div>
                    
                    <!-- Audio Visualizer -->
                    <div class="audio-visualizer" id="audioVisualizer">
                        <div class="audio-info">
                            <h2 id="audioChannelName">Rádio</h2>
                            <p id="audioChannelDesc">Streaming de Áudio</p>
                        </div>
                        
                        <div class="equalizer" id="equalizer">
                            <!-- Barras do equalizador serão geradas via JS -->
                        </div>
                        
                        <div class="audio-controls">
                            <div class="playing-indicator">🎵 Tocando Agora</div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="control-btn" onclick="vibrateFeedback(); previousChannel()">⏮️ Anterior</button>
                    <button class="control-btn" onclick="vibrateFeedback(); togglePlayPause()">⏯️ Play/Pause</button>
                    <button class="control-btn" onclick="vibrateFeedback(); nextChannel()">⏭️ Próximo</button>
                    <button class="control-btn" onclick="vibrateFeedback(); showInfo()">ℹ️ Info</button>
                    <button class="control-btn fullscreen-btn" onclick="vibrateFeedback(); toggleFullscreen()">📺 Tela Cheia</button>
                </div>

                <div class="remote-instructions">
                    <h4>🎮 Controle Remoto/Teclado:</h4>
                    <center><span class="key-hint">↑↓</span> Canais &nbsp;
                    <span class="key-hint">Enter</span> Selecionar &nbsp;
                    <span class="key-hint">Espaço</span> Play/Pause &nbsp;
                    <span class="key-hint">←→</span> Ant/Prox &nbsp;
                    <span class="key-hint">F</span> Tela Cheia &nbsp;
                    <span class="key-hint">i</span> Informações &nbsp;
                    <span class="key-hint">0-9</span> Ir para canal &nbsp;
                    <span class="key-hint">Esc</span> Sair</center>
                </div>
            </div>
        </div>

        <div class="info-panel" id="infoPanel">
            <h3>📺 Informações do Canal</h3>
            <div id="channelInfo">
                <p><strong>Canal:</strong> <span id="currentChannelName">-</span></p>
                <p><strong>Número:</strong> <span id="currentChannelNumber">-</span></p>
                <p><strong>Status:</strong> <span id="channelStatus">Carregando...</span></p>
                <p><strong>Tipo:</strong> <span id="channelType">-</span></p>
            </div>
            <button class="control-btn" onclick="hideInfo()" style="margin-top: 15px;">Fechar</button>
        </div>
    </div>

    <!-- Clappr Player -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@clappr/player@0.4.0/dist/clappr.min.js"></script>
    
    <script>
        // URL do som da splash (pode ser uma URL ou arquivo local)
        const SPLASH_SOUND_URL = 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3'; // Coloque aqui a URL ou caminho do arquivo de áudio
        
        // YouTube API Key - Substitua pela sua chave da API do YouTube Data v3
        // Obtenha gratuitamente em: https://developers.google.com/youtube/v3/getting-started
        const YOUTUBE_API_KEY = 'AIzaSyCNL4lsOgLRiRj1jc_5c0OVTK_E85ChVMc'; // Substitua pela sua chave
        
        // Detecção de dispositivos e plataformas
        const deviceInfo = {
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isIOS: /iPhone|iPad|iPod/i.test(navigator.userAgent),
            isAndroid: /Android/i.test(navigator.userAgent),
            isTV: /SmartTV|WebOS|Tizen|NetCast|CrKey|Android TV|Roku|BRAVIA|DTV|Viera|GoogleTV|AppleTV|AFT/i.test(navigator.userAgent),
            isRoku: /Roku/i.test(navigator.userAgent),
            isTizen: /Tizen/i.test(navigator.userAgent),
            isWebOS: /WebOS|Web0S/i.test(navigator.userAgent),
            isTouchDevice: ('ontouchstart' in window) || (navigator.maxTouchPoints > 0)
        };

        // Configuração dos canais - Incluindo canais de áudio e videos do youtube
        const channels = [
            { number: 1, name: "TV Cultura", url: "https://5b33b873179a2.streamlock.net:1443/live/livestream/playlist.m3u8", type: "video" },
            { number: 2, name: "TV Fundação", url: "https://cdn-fundacao-2110.ciclano.io:1443/fundacao-2110/fundacao-2110/chunklist_w175723033.m3u8", type: "video" },
            { number: 3, name: "TV Band PA", url: "https://cdn.live.br1.jmvstream.com/w/LVW-15748/LVW15748_Yed7yzLuRC/chunklist.m3u8", type: "video" },
			{ number: 4, name: "TV Cine", url: "https://stmv1.srvif.com/tvserie/tvserie/chunklist_w1823388845.m3u8", type: "video" },
			{ number: 5, name: "TV Câmara", url: "https://stream3.camara.gov.br/tv1/manifest.m3u8", type: "video" },
            { number: 6, name: "TV Brasil", url: "https://tvbrasil-stream.ebc.com.br/index.m3u8", type: "video" },
            { number: 7, name: "Cine Classic", url: "https://live20.bozztv.com/giatvplayout7/giatv-208272/tracks-v1a1/mono.ts.m3u8", type: "video" },
            { number: 8, name: "TV Pai Eterno", url: "https://video09.logicahost.com.br/paieterno/paieterno/chunklist_w978992163.m3u8", type: "video" },
            { number: 9, name: "TV Cidade Verde", url: "https://televisaocidadeverde.brasilstream.com.br/hls/televisaocidadeverde/index.m3u8", type: "video" },
            { number: 10, name: "Record MT", url: "https://cdn.live.br1.jmvstream.com/w/LVW-10841/LVW10841_mT77z9o2cP/chunklist.m3u8", type: "video" },
            { number: 11, name: "Rede Manchete", url: "https://stmv1.srvif.com/tvserie/tvserie/chunklist_w2147211548.m3u8", type: "video" },
            { number: 12, name: "Rede TV TO", url: "https://ikki.hubcloud.tv.br/RedeTVTO/tracks-v1a1/mono.m3u8", type: "video" },
            { number: 13, name: "TV Aparecida", url: "https://cdn.jmvstream.com/w/LVW-9716/LVW9716_HbtQtezcaw/playlist.m3u8", type: "video" },
            { number: 14, name: "TV Universal", url: "https://644398c.ha.azioncdn.net/primary/tvuniversal_480p.sdp/chunklist_b946bba4-523a-4655-b6f5-5d73b6135593.m3u8", type: "video" },
            { number: 15, name: "RIT TV", url: "https://acesso.ecast.site:3648/live/ritlive.m3u8", type: "video" },
            { number: 16, name: "TV Mon", url: "https://srv1.zcast.com.br/tvmon/tvmon/playlist.m3u8", type: "video" },
            { number: 17, name: "TV Rede Brasil", url: "https://video09.logicahost.com.br/redebrasiloficial/redebrasiloficial/chunklist_w408678569.m3u8", type: "video" },
            { number: 18, name: "Rede Vida", url: "https://d12e4o88jd8gex.cloudfront.net/out/v1/cea3de0b76ac4e82ab8ee0fd3f17ce12/index_2.m3u8", type: "video" },
            { number: 19, name: "Soul TV", url: "https://video01.soultv.com.br/soultv/soultv/playlist.m3u8", type: "video" },
            { number: 20, name: "TV Rede Gospel", url: "https://cdn.live.br1.jmvstream.com/w/LVW-8719/LVW8719_AcLVAxWy5J/playlist.m3u8", type: "video" },
            { number: 21, name: "TV Galega", url: "https://cdn.jmvstream.com/w/LVW-8538/LVW8538_KBtZ9UMIZn/chunklist.m3u8", type: "video" },
            { number: 22, name: "TV Brusque", url: "https://5ad482a77183d.streamlock.net/rodrigotvbrusque.com.br/_definst_/5d880199c902eb4a1e8df00d/chunklist_w302981591.m3u8", type: "video" },
            { number: 23, name: "TV Dubai Racing", url: "https://dmithrvllta.cdn.mgmlcdn.com/dubairacing/smil:dubairacing.smil/chunklist_b1500000.m3u8", type: "video" },
			{ number: 24, name: "TVR Sul", url: "https://5a57bda70564a.streamlock.net/tvrsul/tvrsul.sdp/chunklist_w1778416456.m3u8", type: "video" },
            { number: 25, name: "TV Mais", url: "https://stmv1.paineltv.net/tvmaisbrasil/tvmaisbrasil/playlist.m3u8", type: "video" },
            { number: 26, name: "TV Mundial", url: "https://58a4464faef53.streamlock.net/impd/ngrp:impd_all/chunklist_w1976879677_b796000.m3u8", type: "video" },
            { number: 27, name: "Rede Plenitude TV", url: "https://meupainel.top:1936/iaptd/iaptd/chunklist_w1718098717.m3u8", type: "video" },
            { number: 28, name: "Fonte TV", url: "https://59fb88a1b1108.streamlock.net/fonte/_definst_/fontetv/chunklist_w1319813731.m3u8", type: "video" },
            { number: 29, name: "TV Novo Tempo", url: "https://stream.live.novotempo.com/tv/smil:tvnovotempo.smil/playlist.m3u8", type: "video" },
            { number: 30, name: "Euro News", url: "https://www.youtube.com/watch?v=XuZAl-ZPEcA", type: "youtube" },
            { number: 31, name: "TV Aberta", url: "https://br5093.streamingdevideo.com.br/tvaberto/tvaberto/playlist.m3u8", type: "video" },
            { number: 32, name: "Rede Família", url: "https://tv03.zas.media:1936/rftv/rftv/playlist.m3u8", type: "video" },
            { number: 33, name: "BS TV", url: "https://br5093.streamingdevideo.com.br/bstv/bstv/playlist.m3u8", type: "video" },
            { number: 34, name: "TV Max 90", url: "https://cdn.jmvstream.com/w/AVJ-15538/playlist/playlist.m3u8", type: "video" },
            { number: 35, name: "TV Thathi", url: "https://cdn-grupo-10049.ciclano.io:1443/grupo-10049/grupo-10049/playlist.m3u8", type: "video" },
            { number: 36, name: "TV ABC Brasil", url: "https://stmv1.srvstm.com/abc7891/abc7891/playlist.m3u8", type: "video" },
            { number: 37, name: "TV Unisantos", url: "https://live.cdn.upx.com/7550/myStream.sdp/playlist.m3u8", type: "video" },
            { number: 38, name: "TV Vintage", url: "https://video01.kshost.com.br:4443/rogerio7271/rogerio7271/playlist.m3u8", type: "video" },
            { number: 39, name: "Rede TV Mais", url: "https://cdn.jmvstream.com/w/AVJ-15235/playlist/playlist.m3u8", type: "video" },
            { number: 40, name: "TV CaZé", url: "https://www.youtube.com/watch?v=vV0Av7QfHqg", type: "youtube" },
            { number: 41, name: "Fox Sports", url: "https://live-news-manifest.tubi.video/live-news-manifest/csm/extlive/tubiprd01,Fox-Sports-Espanol2.m3u8", type: "video" },
            { number: 42, name: "RS News Sports", url: "https://video03.logicahost.com.br/rssports4/rssports4/playlist.m3u8", type: "video" },
            { number: 43, name: "CBS Sports", url: "https://dai.google.com/linear/hls/event/GxrCGmwST0ixsrc_QgB6qw/master.m3u8", type: "video" },
            { number: 44, name: "Rete8 Sport", url: "https://64b16f23efbee.streamlock.net/rete8sport/rete8sport/playlist.m3u8", type: "video" },
            { number: 45, name: "Trace Sport Stars", url: "https://lightning-tracesport-samsungau.amagi.tv/playlist1080p.m3u8", type: "video" },
            { number: 46, name: "Motor Racing TV", url: "https://d35j504z0x2vu2.cloudfront.net/v1/master/0bc8e8376bd8417a1b6761138aa41c26c7309312/motorracing/master.m3u8", type: "video" },
            { number: 47, name: "Sobrenatural TV", url: "https://stream-36723.castr.net/5d714f6a0bd97874e36f14e4/live_057ee4605c1711efbd4135c4457c726c/rewind-3600.m3u8", type: "video" },
            { number: 48, name: "TV Futuro", url: "https://tv03.zas.media:1936/tvfuturo/tvfuturo/playlist.m3u8", type: "video" },
            { number: 49, name: "TV Internacional", url: "https://raw.githubusercontent.com/ipstreet312/freeiptv/master/ressources/tvipt/sh/tviint.m3u8", type: "video" },
            { number: 50, name: "TV Templo", url: "https://664398c.ha.azioncdn.net/primary/tvtemplo_480p.sdp/playlist.m3u8", type: "video" },
            { number: 51, name: "Rede Super", url: "https://tv02.zas.media:1936/redesuper/redesuper/playlist.m3u8", type: "video" },
            { number: 52, name: "CBS News", url: "https://www.cbsnews.com/common/video/cbsn-ny-prod.m3u8", type: "video" },
            { number: 53, name: "SBT Rio", url: "https://www.youtube.com/watch?v=LLpNUqHVam8", type: "youtube" },
            { number: 54, name: "Band TV", url: "https://cdn.jmvstream.com/w/LVW-15748/LVW15748_Yed7yzLuRC/playlist.m3u8", type: "video" },
            { number: 55, name: "SBT PI", url: "https://stmv1.transmissaodigital.com/cidadeverdenovo/cidadeverdenovo/chunklist_w1550736161.m3u8", type: "video" },
            { number: 56, name: "SBT Central", url: "https://www.youtube.com/watch?v=LLpNUqHVam8", type: "youtube" },
            { number: 57, name: "Record RN", url: "https://video07.logicahost.com.br/portaldatropical/portaldatropical/chunklist_w1630150607.m3u8", type: "video" },
            { number: 58, name: "TV Guará", url: "https://video02.logicahost.com.br/tvguara23/tvguara23/chunklist_w578184061.m3u8", type: "video" },
            { number: 59, name: "SBT Ribeirão Preto", url: "https://www.youtube.com/watch?v=wJQUfbr69P0", type: "youtube" },
            { number: 60, name: "RIT TV", url: "https://acesso.ecast.site:3648/live/ritlive.m3u8", type: "video" },
			{ number: 61, name: "CNN Brasil", url: "https://www.youtube.com/watch?v=htZWQlesV-E", type: "youtube" },
            { number: 62, name: "TV Pantanal", url: "https://5a2b083e9f360.streamlock.net/tvpantanal/tvpantanal.sdp/chunklist_w1595845833.m3u8", type: "video" },
			{ number: 63, name: "Câmara Pedro Afonso", url: "https://www.youtube.com/watch?v=5_b3D64oS3A", type: "youtube" },
			{ number: 64, name: "Record News", url: "https://www.youtube.com/watch?v=OuDca0l0uz0", type: "youtube" },
			{ number: 65, name: "TV Senado", url: "https://www.youtube.com/watch?v=2XmxELSjlEg", type: "youtube" },
			{ number: 66, name: "TV Evangelizar", url: "https://tvevangelizar.brasilstream.com.br/hls/tvevangelizar/index.m3u8", type: "video" },
			{ number: 67, name: "Canal Rural", url: "https://607d2a1a47b1f.streamlock.net/crur/smil:canalrural.smil/chunklist_w671731343_b259600_sleng.m3u8", type: "video" },
			{ number: 68, name: "TV ISTV", url: "https://video08.logicahost.com.br/istvnacional/srt.stream/chunklist_w27865936.m3u8", type: "video" },
			{ number: 69, name: "Vima MAX", url: "https://srv3.zcast.com.br/vivaxtv/vivaxtv/chunklist_w1101571165.m3u8", type: "video" },
			{ number: 70, name: "SIC TV", url: "https://d1zx6l1dn8vaj5.cloudfront.net/out/v1/b89cc37caa6d418eb423cf092a2ef970/index_4.m3u8", type: "video" },
			{ number: 71, name: "AWTV", url: "https://streaming.cloudecast.com/hls/awtv/index.m3u8", type: "video" },
			{ number: 72, name: "SIC News TV", url: "https://d277k9d1h9dro4.cloudfront.net/out/v1/293e7c3464824cbd8818ab8e49dc5fe9/index_5.m3u8", type: "video" },
			{ number: 73, name: "TV Aparecida 2", url: "https://www.youtube.com/watch?v=4CAmwaFJo6k", type: "youtube" },
			{ number: 74, name: "SCC SBT", url: "https://www.youtube.com/watch?v=JdGEduIu3MM", type: "youtube" },
			{ number: 75, name: "TV Escola", url: "https://cdn-fundacao-2110.ciclano.io:1443/fundacao-2110/fundacao-2110/chunklist_w175723033.m3u8", type: "video" },
            { number: 76, name: "Rádio Olivença FM", url: "https://server12.srvsh.com.br:8074/stream", type: "audio" },
            { number: 77, name: "Rádio Vale FM", url: "https://s37.maxcast.com.br:8058/live", type: "audio" },
            { number: 78, name: "Rádio Jovem Palmas", url: "http://sd.dnip.com.br:10422/stream", type: "audio" },
			{ number: 79, name: "Rádio HCJB", url: "https://streamingecuador.net:8287/hcjb", type: "audio" },
            { number: 80, name: "Rádio Ativa FM", url: "http://servidor33.brlogic.com:8224/live", type: "audio" },
            { number: 81, name: "Rádio Paraiso FM", url: "https://sonicpanel.oficialserver.com/8112/stream", type: "audio" },
			{ number: 82, name: "Rádio Executiva FM", url: "https://live.ojc.com.br/e9cd_6/myStream.m3u8", type: "video" },
			{ number: 83, name: "CBN Tocantins", url: "https://live.ojc.com.br/e9cd_6/myStream.m3u8", type: "video" },
			{ number: 84, name: "Rádio Tocantins PN", url: "https://sv1.audiostream.com.br/radio/8040/stream", type: "audio" },
			{ number: 85, name: "Rádio Itatiaia", url: "https://8903.brasilstream.com.br/stream", type: "audio" },
			{ number: 86, name: "Rádio Unitins FM", url: "https://live.unitins.br", type: "audio" },
			{ number: 87, name: "Rádio Porto", url: "https://sonicpanel.oficialserver.com:7120/stream", type: "audio" },
			{ number: 88, name: "Rádio Transamérica", url: "https://playerservices.streamtheworld.com/api/livestream-redirect/RT_SPAAC.aac", type: "audio" },
			{ number: 89, name: "TV Nova PE", url: "https://acesso.ecast.site:3675/live/novatvlive.m3u8", type: "video" },
			{ number: 90, name: "TV Canção Nova", url: "https://www.youtube.com/watch?v=3vwVxDEt_OE", type: "youtube" }

        ];

        let currentChannelIndex = 0;
        let focusedChannelIndex = 0;
        let isPlaying = false;
        let currentPlayer = null;
        let currentPlayerType = null; // 'clappr', 'alternative', 'youtube', 'audio'
        let audioContext = null;
        let audioAnalyser = null;
        let audioSource = null;
        let audioVisualizer = null;
        let equalizerBars = [];

        // Buffer para entrada de números
        let numberInputBuffer = "";
        let numberInputTimeout;
        let fullscreenInfoTimeout;

        // Sistema de loop para canais YouTube
        let channelPlaylists = new Map(); // Armazena playlists de cada canal
        let currentVideoIndex = 0; // Índice do vídeo atual na playlist
        let liveCheckInterval = null; // Intervalo para verificar lives
        let isInLiveMode = false; // Se está transmitindo live
        let originalVideoId = null; // ID do vídeo original do canal

        // Elementos DOM
        const channelList = document.getElementById('channelList');
        const clapprContainer = document.getElementById('clappr');
        const alternativeContainer = document.getElementById('alternativePlayer');
        const videoPlaceholder = document.getElementById('videoPlaceholder');
        const infoPanel = document.getElementById('infoPanel');
        const fullscreenInfo = document.getElementById('fullscreenInfo');
        const channelNumberDisplay = document.getElementById('channelNumberDisplay');
        const audioVisualizerEl = document.getElementById('audioVisualizer');

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            initSplashScreen();
        });

        // Gerenciamento do Splash Screen
        function initSplashScreen() {
            const splashScreen = document.getElementById('splashScreen');
            const mainApp = document.getElementById('mainApp');
            const loadingText = document.querySelector('.loading-text');
            
            if (!splashScreen || !mainApp || !loadingText) {
                console.error('Elementos do splash screen não encontrados');
                return;
            }
            
            const loadingMessages = [
                'Inicializando sistema...',
                'Conectando aos servidores...',
                'Carregando canais...',
                'Verificando sinais...',
                'Preparando interface...',
                'Pronto para transmitir!'
            ];
            
            let messageIndex = 0;
            
            const messageInterval = setInterval(() => {
                if (messageIndex < loadingMessages.length && loadingText) {
                    loadingText.textContent = loadingMessages[messageIndex];
                    messageIndex++;
                } else {
                    clearInterval(messageInterval);
                }
            }, 500);
            
            // Toca som da splash
            playSplashSound();
            
            setTimeout(() => {
                if (splashScreen) {
                    splashScreen.style.display = 'none';
                }
                if (mainApp) {
                    mainApp.style.display = 'flex';
                }
                
                initializeApp();
                playStartupSound();
            }, 4000);
        }
        
        // Som da splash screen via URL ou arquivo local
        function playSplashSound() {
            try {
                const audio = new Audio(SPLASH_SOUND_URL);
                audio.volume = 0.3;
                audio.play().catch(e => {
                    console.log('Não foi possível tocar o som da splash:', e);
                });
            } catch (e) {
                console.log('Erro ao carregar som da splash:', e);
            }
        }
        
        // Inicialização da aplicação principal
        function initializeApp() {
            try {
                // Debug de dispositivo
                console.log('Dispositivo detectado:', {
                    userAgent: navigator.userAgent,
                    ...deviceInfo
                });
                
                loadChannels();
                setupKeyboardControls();
                setupRemoteControls();
                setupTouchControls();
                setupAudioVisualizer();
                
                // Ajusta interface baseado no dispositivo
                if (deviceInfo.isMobile) {
                    document.body.classList.add('mobile-device');
                }
                if (deviceInfo.isTV) {
                    document.body.classList.add('tv-device');
                }
                
                // Aguarda um pouco para garantir que os elementos foram criados
                setTimeout(() => {
                    initializeAutoStart();
                }, 200);
            } catch (error) {
                console.error('Erro ao inicializar aplicação:', error);
            }
        }
        
        // Som de inicialização simulado
        function playStartupSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.3);
            } catch (e) {
                console.log('Áudio não disponível');
            }
        }

        // Setup do Audio Visualizer
        function setupAudioVisualizer() {
            const equalizer = document.getElementById('equalizer');
            
            // Cria 32 barras do equalizador
            for (let i = 0; i < 32; i++) {
                const bar = document.createElement('div');
                bar.className = 'equalizer-bar';
                bar.style.animationDelay = `${i * 0.05}s`;
                equalizer.appendChild(bar);
                equalizerBars.push(bar);
            }
            
            // Animação inicial das barras
            setInterval(() => {
                if (audioVisualizerEl.classList.contains('active')) {
                    equalizerBars.forEach((bar, index) => {
                        const height = Math.random() * 140 + 10;
                        bar.style.height = `${height}px`;
                    });
                }
            }, 150);
        }

        // Carrega a lista de canais
        function loadChannels() {
            const channelList = document.getElementById('channelList');
            if (!channelList) {
                console.error('Lista de canais não encontrada');
                return;
            }
            
            channelList.innerHTML = '';
            channels.forEach((channel, index) => {
                const li = document.createElement('li');
                li.className = 'channel-item';
                li.setAttribute('tabindex', '0');
                li.setAttribute('data-index', index);
                
                const typeIcon = getChannelTypeIcon(channel.type);
                li.innerHTML = `
                    <span class="channel-number">${channel.number}</span>
                    <span class="channel-name">${typeIcon} ${channel.name}</span>
                `;
                li.addEventListener('click', () => selectChannel(index));
                channelList.appendChild(li);
            });
        }

        // Retorna ícone baseado no tipo do canal
        function getChannelTypeIcon(type) {
            switch(type) {
                case 'audio': return '🎵';
                case 'youtube': return '🎬';
                case 'video': return '📺';
                default: return '📺';
            }
        }

        // Feedback tátil para dispositivos móveis
        function vibrateFeedback(duration = 50) {
            if (deviceInfo.isMobile && 'vibrate' in navigator) {
                navigator.vibrate(duration);
            }
        }

        // Seleciona um canal
        function selectChannel(index) {
            if (index < 0 || index >= channels.length) {
                console.error('Índice de canal inválido:', index);
                return;
            }
            
            vibrateFeedback();
            
            try {
                console.log(`Selecionando canal ${channels[index].number}: ${channels[index].name}`);
                
                const previousActive = document.querySelector('.channel-item.active');
                if (previousActive) {
                    previousActive.classList.remove('active');
                }
                
                const channelItems = document.querySelectorAll('.channel-item');
                if (channelItems[index]) {
                    channelItems[index].classList.add('active');
                    // Garante que o item fique visível
                    channelItems[index].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                }
                
                currentChannelIndex = index;
                focusedChannelIndex = index;
                
                // Salva último canal assistido
                try {
                    localStorage.setItem('lastWatchedChannel', index.toString());
                } catch (e) {
                    console.log('Não foi possível salvar último canal:', e);
                }
                
                // Força carregamento do canal
                const channel = channels[index];
                console.log(`Carregando canal tipo "${channel.type}":`, channel.url);
                
                loadChannel(channel);
                updateChannelInfo(channel);
                
                // Esconde placeholder inicial
                const placeholder = document.getElementById('videoPlaceholder');
                if (placeholder && placeholder.textContent.includes('Selecione um canal')) {
                    placeholder.style.display = 'none';
                }
                
            } catch (error) {
                console.error('Erro ao selecionar canal:', error);
            }
        }

        // Carrega o canal baseado no tipo
        function loadChannel(channel) {
            console.log('Iniciando carregamento do canal:', channel.name, 'Tipo:', channel.type);
            
            // Limpa players anteriores
            cleanupPlayers();
            
            // Esconde visualizador de áudio
            audioVisualizerEl.classList.remove('active');
            
            // Mostra placeholder de carregamento
            const placeholder = document.getElementById('videoPlaceholder');
            placeholder.style.display = 'flex';
            placeholder.innerHTML = `
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 10px;">Carregando ${channel.name}...</p>
                    <p style="font-size: 0.9rem; color: #ccc;">Canal ${channel.number}</p>
                </div>
            `;
            
            switch(channel.type) {
                case 'youtube':
                    console.log('Carregando canal YouTube...');
                    loadYouTubeChannel(channel);
                    break;
                case 'audio':
                    console.log('Carregando canal de áudio...');
                    loadAudioChannel(channel);
                    break;
                case 'video':
                default:
                    console.log('Carregando canal de vídeo...');
                    loadVideoChannel(channel);
                    break;
            }
        }

        // Carrega canal de vídeo
        function loadVideoChannel(channel) {
            const placeholder = document.getElementById('videoPlaceholder');
            
            if (channel.url.endsWith(".m3u8")) {
                // Tenta usar Clappr primeiro
                placeholder.style.display = 'flex';
                placeholder.innerHTML = '<div class="loading-spinner"></div>';
                clapprContainer.style.display = 'block';
                alternativeContainer.style.display = 'none';
                
                try {
                    currentPlayer = new Clappr.Player({
                        source: channel.url,
                        parentId: "#clappr",
                        width: '100%',
                        height: '100%',
                        autoPlay: !deviceInfo.isMobile,
                        muted: deviceInfo.isMobile,
                        chromeless: false,
                        hideMediaControl: false,
                        hideVolumeBar: false,
                        disableKeyboardShortcuts: true, // Desativa para usar nossos próprios controles
                        disableVideoTagContextMenu: true,
                        watermark: false,
                        watermarkLink: false,
                        mobileUI: deviceInfo.isMobile,
                        playback: {
                            playInline: true,
                            recycleVideo: true,
                            hlsjsConfig: {
                                enableWorker: true,
                                maxBufferLength: deviceInfo.isMobile ? 20 : 30,
                                maxMaxBufferLength: deviceInfo.isMobile ? 300 : 600,
                                liveSyncDurationCount: 3,
                                enableSoftwareAES: deviceInfo.isIOS
                            }
                        },
                        poster: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzFhMWEzYSIvPjwvc3ZnPg==',
                        mediacontrol: {
                            seekbar: "#ff6b35",
                            buttons: "#fff"
                        },
                        events: {
                            onError: function(error) {
                                console.error('Erro no Clappr:', error);
                                // Fallback para player alternativo
                                loadWithAlternativePlayer(channel);
                            },
                            onPlay: function() {
                                isPlaying = true;
                                updateChannelInfo(channel);
                                requestWakeLock();
                            },
                            onPause: function() {
                                isPlaying = false;
                                updateChannelInfo(channel);
                                releaseWakeLock();
                            },
                            onReady: function() {
                                console.log('Player Clappr pronto para ' + channel.name);
                                placeholder.style.display = 'none';
                                currentPlayerType = 'clappr';
                                if (deviceInfo.isMobile && !currentPlayer.isPlaying()) {
                                    currentPlayer.play();
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Erro ao inicializar Clappr:', error);
                    loadWithAlternativePlayer(channel);
                }
            } else {
                loadWithAlternativePlayer(channel);
            }
        }

        // Busca vídeos de um canal do YouTube
        async function fetchChannelVideos(channelId) {
            if (!YOUTUBE_API_KEY || YOUTUBE_API_KEY === 'AIzaSyCNL4lsOgLRiRj1jc_5c0OVTK_E85ChVMc') {
                console.log('API Key do YouTube não configurada, usando apenas vídeo original');
                return [];
            }
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=50&key=${YOUTUBE_API_KEY}`
                );
                
                if (!response.ok) {
                    throw new Error('Erro ao buscar vídeos do canal');
                }
                
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    return data.items.map(item => ({
                        videoId: item.id.videoId,
                        title: item.snippet.title,
                        publishedAt: item.snippet.publishedAt
                    }));
                }
                
                return [];
            } catch (error) {
                console.error('Erro ao buscar vídeos do canal:', error);
                return [];
            }
        }

        // Obtém o ID do canal a partir do ID do vídeo
        async function getChannelIdFromVideo(videoId) {
            if (!YOUTUBE_API_KEY || YOUTUBE_API_KEY === 'AIzaSyCNL4lsOgLRiRj1jc_5c0OVTK_E85ChVMc') {
                return null;
            }
            
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${YOUTUBE_API_KEY}`
                );
                
                if (!response.ok) {
                    throw new Error('Erro ao obter informações do vídeo');
                }
                
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    return data.items[0].snippet.channelId;
                }
                
                return null;
            } catch (error) {
                console.error('Erro ao obter ID do canal:', error);
                return null;
            }
        }

        // Carrega playlist de um canal YouTube
        async function loadYouTubePlaylist(channel) {
            const videoIdMatch = channel.url.match(/(?:youtu\.be\/|youtube\.com.*v=)([^&\n?#]+)/);
            if (!videoIdMatch) return [];
            
            const originalVideoId = videoIdMatch[1];
            const channelId = await getChannelIdFromVideo(originalVideoId);
            
            if (!channelId) {
                console.log('Não foi possível obter ID do canal, usando apenas vídeo original');
                return [{ videoId: originalVideoId, title: channel.name, isOriginal: true }];
            }
            
            const videos = await fetchChannelVideos(channelId);
            
            // Adiciona o vídeo original no início se não estiver na lista
            const originalExists = videos.some(v => v.videoId === originalVideoId);
            if (!originalExists) {
                videos.unshift({ videoId: originalVideoId, title: channel.name, isOriginal: true });
            } else {
                // Marca o vídeo original
                const originalVideo = videos.find(v => v.videoId === originalVideoId);
                if (originalVideo) {
                    originalVideo.isOriginal = true;
                }
            }
            
            console.log(`Playlist carregada para ${channel.name}: ${videos.length} vídeos`);
            return videos;
        }

        // Verifica se há live ativa no canal do YouTube
        async function checkYouTubeLive(videoId, channel) {
            try {
                // Primeiro, tenta obter informações do vídeo para conseguir o channel ID
                const videoResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${YOUTUBE_API_KEY}`
                );
                
                if (!videoResponse.ok) {
                    throw new Error('Erro ao buscar informações do vídeo');
                }
                
                const videoData = await videoResponse.json();
                
                if (!videoData.items || videoData.items.length === 0) {
                    throw new Error('Vídeo não encontrado');
                }
                
                const channelId = videoData.items[0].snippet.channelId;
                
                // Busca lives ativas no canal
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&eventType=live&key=${YOUTUBE_API_KEY}`
                );
                
                if (!searchResponse.ok) {
                    throw new Error('Erro ao buscar lives');
                }
                
                const searchData = await searchResponse.json();
                
                if (searchData.items && searchData.items.length > 0) {
                    // Há uma live ativa, retorna a URL da live
                    const liveVideoId = searchData.items[0].id.videoId;
                    return {
                        isLive: true,
                        videoId: liveVideoId,
                        url: `https://www.youtube.com/watch?v=${liveVideoId}`
                    };
                }
                
                return { isLive: false }; // Não há live ativa
            } catch (error) {
                console.log('Erro ao verificar live do YouTube:', error);
                return { isLive: false };
            }
        }

        // Monitora lives periodicamente
        function startLiveMonitoring(channel) {
            if (!YOUTUBE_API_KEY || YOUTUBE_API_KEY === 'AIzaSyCNL4lsOgLRiRj1jc_5c0OVTK_E85ChVMc') {
                return;
            }
            
            if (liveCheckInterval) {
                clearInterval(liveCheckInterval);
            }
            
            const videoIdMatch = channel.url.match(/(?:youtu\.be\/|youtube\.com.*v=)([^&\n?#]+)/);
            if (!videoIdMatch) return;
            
            const channelOriginalVideoId = videoIdMatch[1];
            
            // Verifica live a cada 2 minutos
            liveCheckInterval = setInterval(async () => {
                if (channels[currentChannelIndex] === channel && currentPlayerType === 'youtube') {
                    const liveResult = await checkYouTubeLive(channelOriginalVideoId, channel);
                    
                    if (liveResult.isLive && !isInLiveMode) {
                        console.log('Live detectada! Mudando para transmissão ao vivo');
                        isInLiveMode = true;
                        loadYouTubePlayer(liveResult.url, channel, true);
                    } else if (!liveResult.isLive && isInLiveMode) {
                        console.log('Live terminou! Retornando à playlist');
                        isInLiveMode = false;
                        // Retorna ao vídeo original e continua playlist
                        const playlist = channelPlaylists.get(channel.number) || [];
                        const originalIndex = playlist.findIndex(v => v.isOriginal);
                        currentVideoIndex = originalIndex >= 0 ? originalIndex : 0;
                        playCurrentVideo(channel);
                    }
                }
            }, 120000); // 2 minutos
        }

        // Para o monitoramento de lives
        function stopLiveMonitoring() {
            if (liveCheckInterval) {
                clearInterval(liveCheckInterval);
                liveCheckInterval = null;
            }
        }

        // Carrega canal do YouTube
        async function loadYouTubeChannel(channel) {
            const placeholder = document.getElementById('videoPlaceholder');
            
            // Para monitoramento anterior se existir
            stopLiveMonitoring();
            isInLiveMode = false;
            
            // Extrai ID do vídeo
            const videoIdMatch = channel.url.match(/(?:youtu\.be\/|youtube\.com.*v=)([^&\n?#]+)/);
            if (videoIdMatch) {
                const videoId = videoIdMatch[1];
                originalVideoId = videoId;
                
                // Carrega playlist do canal se ainda não foi carregada
                if (!channelPlaylists.has(channel.number)) {
                    placeholder.style.display = 'flex';
                    placeholder.innerHTML = '<div class="loading-spinner"></div><p style="margin-top: 10px;">Carregando playlist do canal...</p>';
                    
                    const playlist = await loadYouTubePlaylist(channel);
                    channelPlaylists.set(channel.number, playlist);
                    
                    // Inicia no vídeo original
                    const originalIndex = playlist.findIndex(v => v.isOriginal);
                    currentVideoIndex = originalIndex >= 0 ? originalIndex : 0;
                } else {
                    // Playlist já carregada, inicia no vídeo original
                    const playlist = channelPlaylists.get(channel.number);
                    const originalIndex = playlist.findIndex(v => v.isOriginal);
                    currentVideoIndex = originalIndex >= 0 ? originalIndex : 0;
                }
                
                // Verifica se há live ativo (se API key estiver configurada)
                if (YOUTUBE_API_KEY && YOUTUBE_API_KEY !== 'AIzaSyCNL4lsOgLRiRj1jc_5c0OVTK_E85ChVMc') {
                    const liveResult = await checkYouTubeLive(videoId, channel);
                    if (liveResult.isLive) {
                        console.log('Live detectada, transmitindo ao vivo:', liveResult.url);
                        isInLiveMode = true;
                        loadYouTubePlayer(liveResult.url, channel, true);
                        startLiveMonitoring(channel);
                        return;
                    }
                }
                
                // Inicia playlist normal
                playCurrentVideo(channel);
                startLiveMonitoring(channel);
            } else {
                showError(channel);
            }
        }

        // Reproduz o vídeo atual da playlist
        function playCurrentVideo(channel) {
            const playlist = channelPlaylists.get(channel.number);
            if (!playlist || playlist.length === 0) {
                showError(channel);
                return;
            }
            
            const currentVideo = playlist[currentVideoIndex];
            if (!currentVideo) {
                currentVideoIndex = 0;
                playCurrentVideo(channel);
                return;
            }
            
            const videoUrl = `https://www.youtube.com/watch?v=${currentVideo.videoId}`;
            console.log(`Reproduzindo vídeo ${currentVideoIndex + 1}/${playlist.length}: ${currentVideo.title}`);
            
            loadYouTubePlayer(videoUrl, channel, false, () => {
                // Callback quando o vídeo terminar
                setTimeout(() => {
                    if (!isInLiveMode && channels[currentChannelIndex] === channel) {
                        nextVideoInPlaylist(channel);
                    }
                }, 1000);
            });
        }

        // Avança para o próximo vídeo da playlist
        function nextVideoInPlaylist(channel) {
            const playlist = channelPlaylists.get(channel.number);
            if (!playlist || playlist.length === 0) return;
            
            currentVideoIndex++;
            
            // Se chegou ao fim, volta ao início (loop)
            if (currentVideoIndex >= playlist.length) {
                currentVideoIndex = 0;
                console.log('Fim da playlist, reiniciando do primeiro vídeo');
            }
            
            // Pequeno delay antes de carregar próximo vídeo
            setTimeout(() => {
                if (!isInLiveMode && channels[currentChannelIndex] === channel) {
                    playCurrentVideo(channel);
                }
            }, 2000);
        }

        // Carrega o player do YouTube
        function loadYouTubePlayer(url, channel, isLive, onVideoEnd = null) {
            const placeholder = document.getElementById('videoPlaceholder');
            const videoIdMatch = url.match(/(?:youtu\.be\/|youtube\.com.*v=)([^&\n?#]+)/);
            
            if (videoIdMatch) {
                const videoId = videoIdMatch[1];
                
                placeholder.style.display = 'none';
                clapprContainer.style.display = 'block';
                alternativeContainer.style.display = 'none';
                
                const liveParams = isLive ? '&live=1' : '';
                const hdParams = '&vq=hd720'; // Força qualidade HD
                
                clapprContainer.innerHTML = `
                    <iframe 
                        id="ytplayer"
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/${videoId}?autoplay=1&playsinline=1&controls=1&rel=0&modestbranding=1&enablejsapi=1&quality=hd720${liveParams}${hdParams}"
                        frameborder="0"
                        allow="autoplay; encrypted-media; fullscreen"
                        allowfullscreen
                        style="border-radius:10px;">
                    </iframe>
                `;
                
                currentPlayer = { 
                    type: 'youtube', 
                    videoId: videoId, 
                    isLive: isLive,
                    onVideoEnd: onVideoEnd
                };
                currentPlayerType = 'youtube';
                isPlaying = true;
                updateChannelInfo(channel);
                
                // Configura listener para eventos do YouTube
                setupYouTubeEventListener(onVideoEnd);
                
                if (isLive) {
                    // Atualiza o nome do canal para indicar que é live
                    const originalName = channel.name;
                    document.getElementById('currentChannelName').textContent = `🔴 ${originalName} (AO VIVO)`;
                    document.getElementById('fsChannelName').textContent = `🔴 ${originalName} (AO VIVO)`;
                } else {
                    // Mostra informações da playlist se disponível
                    const playlist = channelPlaylists.get(channel.number);
                    if (playlist && playlist.length > 1) {
                        const currentVideo = playlist[currentVideoIndex];
                        const playlistInfo = ` (${currentVideoIndex + 1}/${playlist.length})`;
                        document.getElementById('currentChannelName').textContent = channel.name + playlistInfo;
                        document.getElementById('fsChannelName').textContent = channel.name + playlistInfo;
                    }
                }
            }
        }

        // Configura listener para eventos do YouTube
        function setupYouTubeEventListener(onVideoEnd) {
            // Remove listener anterior se existir
            if (window.youtubeEventListener) {
                window.removeEventListener('message', window.youtubeEventListener);
            }
            
            window.youtubeEventListener = function(e) {
                if (e.origin === 'https://www.youtube.com') {
                    try {
                        if (typeof e.data === 'string' && e.data.includes('event')) {
                            const data = JSON.parse(e.data);
                            if (data.event === 'onStateChange') {
                                switch(data.info) {
                                    case 0: // Vídeo terminou
                                        console.log('Vídeo do YouTube terminou');
                                        isPlaying = false;
                                        releaseWakeLock();
                                        if (onVideoEnd && !isInLiveMode) {
                                            onVideoEnd();
                                        }
                                        break;
                                    case 1: // Playing
                                        isPlaying = true;
                                        requestWakeLock();
                                        // Tenta definir qualidade HD após iniciar
                                        setTimeout(() => {
                                            setYouTubeQuality('hd720');
                                        }, 2000);
                                        break;
                                    case 2: // Paused
                                        isPlaying = false;
                                        releaseWakeLock();
                                        break;
                                }
                                if (channels[currentChannelIndex]) {
                                    updateChannelInfo(channels[currentChannelIndex]);
                                }
                            }
                        }
                    } catch (error) {
                        // Ignora erros de parsing
                    }
                }
            };
            
            window.addEventListener('message', window.youtubeEventListener);
        }

        // Define qualidade do vídeo YouTube
        function setYouTubeQuality(quality) {
            const iframe = document.getElementById('ytplayer');
            if (iframe) {
                try {
                    iframe.contentWindow.postMessage(
                        `{"event":"command","func":"setPlaybackQuality","args":["${quality}"]}`, 
                        '*'
                    );
                    console.log(`Qualidade definida para: ${quality}`);
                } catch (e) {
                    console.log('Não foi possível definir qualidade:', e);
                }
            }
        }

        // Carrega canal de áudio
        function loadAudioChannel(channel) {
            const placeholder = document.getElementById('videoPlaceholder');
            
            placeholder.style.display = 'none';
            clapprContainer.style.display = 'none';
            alternativeContainer.style.display = 'none';
            
            // Mostra visualizador de áudio
            audioVisualizerEl.classList.add('active');
            document.getElementById('audioChannelName').textContent = channel.name;
            document.getElementById('audioChannelDesc').textContent = `Canal ${channel.number} - Streaming de Áudio`;
            
            // Cria elemento de áudio
            const audio = document.createElement('audio');
            audio.src = channel.url;
            audio.autoplay = true;
            audio.controls = false;
            audio.crossOrigin = 'anonymous';
            
            audio.addEventListener('play', () => {
                isPlaying = true;
                updateChannelInfo(channel);
                requestWakeLock();
            });
            
            audio.addEventListener('pause', () => {
                isPlaying = false;
                updateChannelInfo(channel);
                releaseWakeLock();
            });
            
            audio.addEventListener('error', (e) => {
                console.error('Erro no áudio:', e);
                showError(channel);
            });
            
            currentPlayer = audio;
            currentPlayerType = 'audio';
            
            // Inicia reprodução
            audio.play().catch(e => {
                console.error('Erro ao reproduzir áudio:', e);
                showError(channel);
            });
        }

        // Player alternativo para formatos não suportados pelo Clappr
        function loadWithAlternativePlayer(channel) {
            const placeholder = document.getElementById('videoPlaceholder');
            
            placeholder.style.display = 'flex';
            placeholder.innerHTML = '<div class="loading-spinner"></div>';
            clapprContainer.style.display = 'none';
            alternativeContainer.style.display = 'block';
            
            // Determina se é vídeo ou áudio baseado na extensão
            const isVideoFile = /\.(mp4|webm|ogg|avi|mkv|mov)(\?.*)?$/i.test(channel.url);
            const isAudioFile = /\.(mp3|wav|ogg|aac|m4a|flac)(\?.*)?$/i.test(channel.url);
            
            let element;
            if (isVideoFile || channel.url.includes('m3u8')) {
                element = document.createElement('video');
                element.controls = true;
                element.style.width = '100%';
                element.style.height = '100%';
                element.style.borderRadius = '10px';
            } else {
                // Assume que é áudio
                loadAudioChannel(channel);
                return;
            }
            
            element.src = channel.url;
            element.autoplay = !deviceInfo.isMobile;
            element.muted = deviceInfo.isMobile;
            element.playsInline = true;
            element.crossOrigin = 'anonymous';
            
            element.addEventListener('loadstart', () => {
                console.log('Carregando com player alternativo...');
            });
            
            element.addEventListener('canplay', () => {
                placeholder.style.display = 'none';
                currentPlayerType = 'alternative';
            });
            
            element.addEventListener('play', () => {
                isPlaying = true;
                updateChannelInfo(channel);
                requestWakeLock();
            });
            
            element.addEventListener('pause', () => {
                isPlaying = false;
                updateChannelInfo(channel);
                releaseWakeLock();
            });
            
            element.addEventListener('error', (e) => {
                console.error('Erro no player alternativo:', e);
                showError(channel);
            });
            
            alternativeContainer.innerHTML = '';
            alternativeContainer.appendChild(element);
            currentPlayer = element;
            
            // Tenta reproduzir
            element.play().catch(e => {
                console.error('Erro ao reproduzir com player alternativo:', e);
            });
        }

        // Limpa todos os players
        function cleanupPlayers() {
            // Para monitoramento de lives
            stopLiveMonitoring();
            isInLiveMode = false;
            
            // Remove listener do YouTube
            if (window.youtubeEventListener) {
                window.removeEventListener('message', window.youtubeEventListener);
                window.youtubeEventListener = null;
            }
            
            if (currentPlayer) {
                if (currentPlayerType === 'clappr' && currentPlayer.destroy) {
                    currentPlayer.destroy();
                } else if (currentPlayerType === 'alternative' || currentPlayerType === 'audio') {
                    if (currentPlayer.pause) currentPlayer.pause();
                }
                currentPlayer = null;
            }
            
            currentPlayerType = null;
            clapprContainer.innerHTML = '';
            alternativeContainer.innerHTML = '';
        }

        // Mostra erro de carregamento
        function showError(channel) {
            const placeholder = document.getElementById('videoPlaceholder');
            
            cleanupPlayers();
            audioVisualizerEl.classList.remove('active');
            
            clapprContainer.style.display = 'none';
            alternativeContainer.style.display = 'none';
            placeholder.style.display = 'flex';
            placeholder.innerHTML = `
                <div style="text-align: center;">
                    <h3>❌ Erro ao carregar ${channel.name}</h3>
                    <p>Canal ${channel.number}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #ccc;">
                        Não foi possível carregar este canal.<br>
                        Tente novamente ou selecione outro canal.
                    </p>
                    <button class="control-btn" onclick="selectChannel(${currentChannelIndex})" style="margin-top: 20px;">
                        🔄 Tentar Novamente
                    </button>
                </div>
            `;
        }

        // Controles de fullscreen melhorados
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                // Entra em tela cheia
                const container = document.querySelector('.video-container');
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.mozRequestFullScreen) {
                    container.mozRequestFullScreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
            } else {
                // Sai da tela cheia
                exitFullscreen();
            }
        }

        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        // Foca em um canal na lista
        function focusChannel(index) {
            if (index < 0 || index >= channels.length) return;
            
            try {
                const channelItems = document.querySelectorAll('.channel-item');
                if (channelItems.length === 0) {
                    console.warn('Nenhum canal encontrado para focar');
                    return;
                }
                
                channelItems.forEach(item => {
                    if (item && item.classList) {
                        item.classList.remove('focused');
                    }
                });
                
                if (channelItems[index] && channelItems[index].classList) {
                    channelItems[index].classList.add('focused');
                    channelItems[index].focus();
                    
                    focusedChannelIndex = index;
                    
                    channelItems[index].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                }
            } catch (error) {
                console.error('Erro ao focar canal:', error);
            }
        }

        // Controles de navegação
        function nextChannel() {
            const nextIndex = (currentChannelIndex + 1) % channels.length;
            selectChannel(nextIndex);
        }

        function previousChannel() {
            const prevIndex = currentChannelIndex === 0 ? channels.length - 1 : currentChannelIndex - 1;
            selectChannel(prevIndex);
        }

        function togglePlayPause() {
            if (!channels[currentChannelIndex]) return;
            
            switch(currentPlayerType) {
                case 'youtube':
                    const iframe = document.getElementById('ytplayer');
                    if (iframe) {
                        if (isPlaying) {
                            iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                            isPlaying = false;
                        } else {
                            iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                            isPlaying = true;
                        }
                        updateChannelInfo(channels[currentChannelIndex]);
                    }
                    break;
                    
                case 'clappr':
                    if (currentPlayer && currentPlayer.isPlaying) {
                        if (currentPlayer.isPlaying()) {
                            currentPlayer.pause();
                        } else {
                            currentPlayer.play();
                        }
                    }
                    break;
                    
                case 'alternative':
                case 'audio':
                    if (currentPlayer) {
                        if (currentPlayer.paused) {
                            currentPlayer.play();
                        } else {
                            currentPlayer.pause();
                        }
                    }
                    break;
                    
                default:
                    // Se não há player ativo, recarrega o canal
                    selectChannel(currentChannelIndex);
                    break;
            }
        }

        // Informações do canal
        function showInfo() {
            if (channels[currentChannelIndex]) {
                updateChannelInfo(channels[currentChannelIndex]);
                
                if (isInFullscreen()) {
                    // Mostra info em fullscreen
                    const fsInfo = document.getElementById('fullscreenInfo');
                    fsInfo.style.display = 'block';
                    fsInfo.style.visibility = 'visible';
                    fsInfo.style.opacity = '1';
                    
                    // Garante que está no topo
                    fsInfo.style.zIndex = '2147483647';
                    
                    // Auto-hide após 7 segundos
                    if (fullscreenInfoTimeout) clearTimeout(fullscreenInfoTimeout);
                    fullscreenInfoTimeout = setTimeout(() => {
                        hideInfo();
                    }, 7000);
                    
                    console.log('Mostrando info em fullscreen');
                } else {
                    // Mostra info normal
                    infoPanel.style.display = 'block';
                }
            }
        }

        function hideInfo() {
            const infoPanel = document.getElementById('infoPanel');
            const fsInfo = document.getElementById('fullscreenInfo');
            
            if (infoPanel) {
                infoPanel.style.display = 'none';
            }
            
            if (fsInfo) {
                fsInfo.style.display = 'none';
                fsInfo.style.visibility = 'hidden';
                fsInfo.style.opacity = '0';
            }
            
            if (fullscreenInfoTimeout) {
                clearTimeout(fullscreenInfoTimeout);
                fullscreenInfoTimeout = null;
            }
        }

        function updateChannelInfo(channel) {
            const updateElements = (prefix) => {
                const nameEl = document.getElementById(`${prefix}ChannelName`);
                const numberEl = document.getElementById(`${prefix}ChannelNumber`);
                const statusEl = document.getElementById(`${prefix}ChannelStatus`);
                const typeEl = document.getElementById(`${prefix}ChannelType`);
                
                if (nameEl) nameEl.textContent = channel.name;
                if (numberEl) numberEl.textContent = channel.number;
                if (typeEl) {
                    switch(channel.type) {
                        case 'audio': typeEl.textContent = 'Rádio/Áudio'; break;
                        case 'youtube': typeEl.textContent = 'YouTube'; break;
                        case 'video': typeEl.textContent = 'TV/Vídeo'; break;
                        default: typeEl.textContent = 'Streaming'; break;
                    }
                }
                if (statusEl) {
                    if (channel.type === 'audio') {
                        statusEl.textContent = isPlaying ? 'Tocando' : 'Pausado';
                    } else {
                        statusEl.textContent = isPlaying ? 'Transmitindo ao vivo' : 'Pausado';
                    }
                }
            };
            
            // Atualiza info normal
            updateElements('current');
            updateElements('channel');
            
            // Atualiza info fullscreen
            updateElements('fs');
        }

        // Handler para entrada de números
        function handleNumberInput(key) {
            numberInputBuffer += key;
            
            // Mostra o display de números
            if (channelNumberDisplay) {
                channelNumberDisplay.textContent = numberInputBuffer;
                channelNumberDisplay.style.display = 'block';
            }

            if (numberInputTimeout) clearTimeout(numberInputTimeout);

            numberInputTimeout = setTimeout(() => {
                const channelNumber = parseInt(numberInputBuffer);
                const channelIndex = channels.findIndex(ch => ch.number === channelNumber);
                if (channelIndex !== -1) {
                    selectChannel(channelIndex);
                    focusChannel(channelIndex);
                }
                numberInputBuffer = "";
                
                // Esconde o display de números
                if (channelNumberDisplay) {
                    setTimeout(() => {
                        channelNumberDisplay.style.display = 'none';
                    }, 500);
                }
            }, 1500);
        }

        // Controles de teclado melhorados para fullscreen
        function setupKeyboardControls() {
            const keyboardHandler = function(event) {
                // Previne comportamento padrão para todas as teclas que vamos interceptar
                const preventDefaultKeys = [
                    'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 
                    'Enter', 'NumpadEnter', 'Space', 'KeyF', 'KeyI'
                ];
                
                // Permite ESC apenas para sair de fullscreen
                if (event.code === 'Escape') {
                    if (isInFullscreen()) {
                        event.preventDefault();
                        event.stopPropagation();
                        hideInfo(); // Esconde info se estiver mostrando
                        exitFullscreen();
                        return;
                    } else {
                        // Se não está em fullscreen, permite comportamento normal do ESC
                        hideInfo();
                        return;
                    }
                }
                
                // Previne comportamento padrão para teclas controladas
                if (preventDefaultKeys.includes(event.code)) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                // Detecta entrada de números para navegação direta
                if (/^Digit[0-9]$/.test(event.code) || /^Numpad[0-9]$/.test(event.code)) {
                    event.preventDefault();
                    event.stopPropagation();
                    const digit = event.code.replace(/\D/g, '');
                    handleNumberInput(digit);
                    return;
                }
                
                switch(event.code) {
                    case 'ArrowUp':
                        const prevFocus = focusedChannelIndex === 0 ? channels.length - 1 : focusedChannelIndex - 1;
                        focusChannel(prevFocus);
                        break;
                        
                    case 'ArrowDown':
                        const nextFocus = (focusedChannelIndex + 1) % channels.length;
                        focusChannel(nextFocus);
                        break;
                        
                    case 'Enter':
                    case 'NumpadEnter':
                        selectChannel(focusedChannelIndex);
                        break;
                        
                    case 'ArrowLeft':
                        previousChannel();
                        break;
                        
                    case 'ArrowRight':
                        nextChannel();
                        break;
                        
                    case 'Space':
                        togglePlayPause();
                        break;
                        
                    case 'KeyF':
                        toggleFullscreen();
                        break;
                        
                    case 'KeyI':
                        if (fullscreenInfo.style.display === 'block') {
                            hideInfo();
                        } else {
                            showInfo();
                        }
                        break;
                }
            };
            
            // Adiciona listeners com capture=true para garantir que sejam chamados primeiro
            document.addEventListener('keydown', keyboardHandler, true);
            window.addEventListener('keydown', keyboardHandler, true);
            
            // Re-adiciona listeners quando entra/sai de fullscreen
            document.addEventListener('fullscreenchange', function() {
                setTimeout(() => {
                    document.removeEventListener('keydown', keyboardHandler, true);
                    window.removeEventListener('keydown', keyboardHandler, true);
                    document.addEventListener('keydown', keyboardHandler, true);
                    window.addEventListener('keydown', keyboardHandler, true);
                }, 100);
            });
        }

        // Controles específicos para TVs
        function setupRemoteControls() {
            if (deviceInfo.isTV || deviceInfo.isRoku) {
                document.body.classList.add('smart-tv');
                
                const remoteHandler = function(event) {
                    // Navegação por números (0-9) para controles remotos
                    if (event.keyCode >= 48 && event.keyCode <= 57) {
                        event.preventDefault();
                        event.stopPropagation();
                        const digit = String(event.keyCode - 48);
                        handleNumberInput(digit);
                        return;
                    }
                    
                    // Códigos de teclas para controles remotos de TV
                    switch(event.keyCode) {
                        // Botões coloridos
                        case 403: // Red - Info
                            showInfo();
                            break;
                        case 404: // Green - Play/Pause
                            togglePlayPause();
                            break;
                        case 405: // Yellow - Tela Cheia
                            toggleFullscreen();
                            break;
                        case 406: // Blue - Lista de canais
                            focusChannel(0);
                            break;
                            
                        // Teclas genéricas para TVs
                        case 122: // F11 - Tela Cheia (genérica)
                        case 48: // ZOOM - Tela Cheia (Samsung/LG)
                        case 220: // Aspect Ratio - Tela Cheia (Sony)
                        case 174: // Volume Down usado como tela cheia em algumas TVs
                            event.preventDefault();
                            event.stopPropagation();
                            toggleFullscreen();
                            break;
                            
                        case 457: // INFO - Informações (genérica)
                        case 18: // ALT (usado como INFO em algumas TVs)
                        case 36: // HOME (usado como INFO em algumas TVs)
                        case 116: // F5 (usado como INFO em algumas TVs)
                            event.preventDefault();
                            event.stopPropagation();
                            showInfo();
                            break;
                            
                        // Navegação - APENAS ESC sai de fullscreen
                        case 10009: // Return/Back
                        case 8: // Backspace (Roku)
                            if (isInFullscreen()) {
                                if (fullscreenInfo.style.display === 'block') {
                                    hideInfo();
                                } else {
                                    exitFullscreen();
                                }
                            } else {
                                hideInfo();
                            }
                            break;
                            
                        case 427: // Channel Up
                        case 33: // Page Up
                            nextChannel();
                            break;
                            
                        case 428: // Channel Down
                        case 34: // Page Down
                            previousChannel();
                            break;
                            
                        // Media controls
                        case 415: // Play
                        case 179: // Play/Pause
                            togglePlayPause();
                            break;
                            
                        case 19: // Pause
                        case 413: // Stop
                            if (currentPlayer) {
                                if (currentPlayerType === 'youtube') {
                                    const iframe = document.getElementById('ytplayer');
                                    if (iframe && isPlaying) {
                                        iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                                        isPlaying = false;
                                    }
                                } else if (currentPlayer.pause) {
                                    currentPlayer.pause();
                                }
                            }
                            break;
                            
                        case 13: // Enter/OK
                        case 195: // OK (alguns controles)
                            if (document.activeElement.classList.contains('channel-item')) {
                                const index = parseInt(document.activeElement.getAttribute('data-index'));
                                selectChannel(index);
                            }
                            break;
                    }
                };
                
                document.addEventListener('keydown', remoteHandler, true);
                window.addEventListener('keydown', remoteHandler, true);
            }
        }

        // Controles Touch/Swipe para mobile
        function setupTouchControls() {
            if (!deviceInfo.isTouchDevice) return;
            
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            
            const videoContainer = document.querySelector('.video-container');
            const channelListEl = document.querySelector('.channel-list');
            
            if (videoContainer) {
                videoContainer.addEventListener('touchstart', function(e) {
                    touchStartX = e.changedTouches[0].screenX;
                    touchStartY = e.changedTouches[0].screenY;
                }, { passive: true });
                
                videoContainer.addEventListener('touchend', function(e) {
                    touchEndX = e.changedTouches[0].screenX;
                    touchEndY = e.changedTouches[0].screenY;
                    handleSwipe();
                }, { passive: true });
            }
            
            function handleSwipe() {
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                const minSwipeDistance = 50;
                
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > minSwipeDistance) {
                    if (diffX > 0) {
                        previousChannel();
                    } else {
                        nextChannel();
                    }
                }
                
                if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > minSwipeDistance) {
                    if (diffY > 0) {
                        showInfo();
                    } else {
                        if (infoPanel.style.display === 'block') {
                            hideInfo();
                        } else {
                            toggleFullscreen();
                        }
                    }
                }
            }
            
            // Double tap para play/pause
            let lastTap = 0;
            videoContainer.addEventListener('touchend', function(e) {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 500 && tapLength > 0) {
                    e.preventDefault();
                    togglePlayPause();
                }
                lastTap = currentTime;
            });
        }

        // Wake Lock
        let wakeLock = null;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator && !deviceInfo.isMobile) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake lock ativado');
                }
            } catch (err) {
                console.error('Erro ao ativar wake lock:', err);
            }
        }

        function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        }

        // Auto-foco inicial e garantia de auto-start
        window.addEventListener('load', function() {
            setTimeout(() => {
                focusChannel(0);
                // Garantia adicional de auto-start
                if (!currentPlayer && !isPlaying) {
                    console.log('Auto-start adicional executado...');
                    selectChannel(0);
                }
            }, 500);
        });

        // Garantia final de auto-start após tudo carregar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                // Última verificação - se nada estiver rodando, força canal 0
                if (!currentPlayer && !isPlaying) {
                    console.log('Garantia final de auto-start...');
                    selectChannel(0);
                }
            }, 5000);
        });

        // Event listeners para fullscreen
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);

        function handleFullscreenChange() {
            const isFullscreen = !!(document.fullscreenElement || 
                                   document.webkitFullscreenElement || 
                                   document.mozFullScreenElement || 
                                   document.msFullscreenElement);
            
            if (!isFullscreen) {
                // Saiu de fullscreen, esconde info se estiver mostrando
                hideInfo();
            }
            
            console.log('Fullscreen mudou:', isFullscreen);
        }

        // Função auxiliar para verificar se está em fullscreen
        function isInFullscreen() {
            return !!(document.fullscreenElement || 
                     document.webkitFullscreenElement || 
                     document.mozFullScreenElement || 
                     document.msFullscreenElement);
        }
    </script>

    <!-- 
    ========================================
    CONFIGURAÇÃO DA API DO YOUTUBE (OPCIONAL)
    ========================================
    
    Para ativar recursos avançados do YouTube:
    - Detecção automática de lives
    - Sistema de playlist/loop por canal
    - Reprodução automática de todos os vídeos do canal
    
    1. Acesse: https://console.developers.google.com/
    2. Crie um novo projeto ou selecione um existente
    3. Ative a "YouTube Data API v3"
    4. Crie uma chave de API (API Key)
    5. Substitua "AIzaSyCNL4lsOgLRiRj1jc_5c0OVTK_E85ChVMc" na linha 169 pela sua chave
    
    FUNCIONALIDADES COM API CONFIGURADA:
    - Quando um canal YouTube estiver fazendo live, automaticamente 
      será exibida a transmissão ao vivo
    - Quando não há live, será reproduzido o vídeo específico configurado
    - Após o vídeo terminar, automaticamente reproduzirá os outros 
      vídeos do canal, do mais recente ao mais antigo
    - Após todos os vídeos, reinicia o loop infinitamente
    - Qualidade HD forçada em todos os vídeos
    - Auto-start do último canal assistido
    
    SEM API CONFIGURADA:
    - Os canais YouTube funcionam normalmente reproduzindo apenas
      o vídeo específico da URL configurada
    - Não há sistema de playlist automática
    - Não há detecção de lives
    
    TECLAS DE CONTROLE REMOTO:
    - Tela Cheia: F11, tecla ZOOM, tecla Aspect Ratio, Volume Down
    - Informações: INFO, ALT, HOME, F5
    - Todos os demais controles funcionam normalmente
    ========================================

========================================
COMO TROCAR O SOM DA INTRO/SPLASH
========================================

LINHA 168: Troque o arquivo de áudio da splash screen

LOCALIZAÇÃO:
const SPLASH_SOUND_URL = 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3';

INSTRUÇÕES:
1. Substitua 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3' pela URL ou caminho do seu arquivo
2. Formatos suportados: MP3, WAV, OGG, AAC

EXEMPLOS:
- Arquivo local: 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3'
- URL externa: 'https://roku-streaming-server.onrender.com/vinheta-plim-plim-hd.mp3'  
- Sem som: '' (deixe vazio para desativar)

LINHA EXATA PARA ALTERAR:
const SPLASH_SOUND_URL = 'SEU_ARQUIVO_DE_AUDIO_AQUI';

NOTA: O arquivo deve estar na mesma pasta do HTML ou ser uma URL válida
========================================
-->

<script>
// Mostra o nome do canal no canto superior esquerdo
function showActiveChannelNameOverlay() {
    const overlay = document.createElement('div');
    overlay.id = 'channel-name-overlay';
    overlay.style.position = 'absolute';
    overlay.style.top = '10px';
    overlay.style.left = '10px';
    overlay.style.zIndex = '99999';
    overlay.style.color = 'rgba(255, 255, 255, 0.8)';
    overlay.style.fontSize = '1.2rem';
    overlay.style.fontWeight = 'bold';
    overlay.style.textShadow = '1px 1px 3px black';
    overlay.style.pointerEvents = 'none';
    overlay.style.transition = 'opacity 0.3s';
    document.querySelector('.video-container')?.appendChild(overlay);

    const updateOverlay = () => {
        const channel = channels[currentChannelIndex];
        if (channel && overlay) {
            overlay.textContent = channel.name;
            overlay.style.display = 'block';
        }
    };

    // Atualiza sempre que canal mudar
    const originalSelectChannel = selectChannel;
    selectChannel = function(index) {
        originalSelectChannel(index);
        setTimeout(updateOverlay, 500);
    };
}

// Inicializa a exibição do nome do canal
window.addEventListener('DOMContentLoaded', () => {
    showActiveChannelNameOverlay();
});
</script>

</body>
</html>